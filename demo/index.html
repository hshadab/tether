<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trustless Risk Gating for Tether WDK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1e293b;
            min-height: 100vh;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #f1f5f9;
            letter-spacing: -0.02em;
        }

        header .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
            margin-bottom: 24px;
        }

        .integration-badges {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .integration-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #cbd5e1;
        }

        .integration-badge .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .integration-badge .dot.wdk {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }

        .integration-badge .dot.jolt {
            background: #8b5cf6;
            box-shadow: 0 0 8px rgba(139, 92, 246, 0.5);
        }

        .integration-badge .dot.live {
            background: #22d3ee;
            box-shadow: 0 0 8px rgba(34, 211, 238, 0.5);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .value-props {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 24px;
            margin-top: 20px;
        }

        .value-prop {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .value-prop .check {
            color: #10b981;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Control Panel */
        .control-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-panel h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #10b981;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            color: #94a3b8;
            margin-bottom: 6px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(15, 23, 42, 0.8);
            color: #f1f5f9;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
        }

        .preset-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .preset-btn {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: transparent;
            color: #fff;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .preset-btn.safe {
            border-color: #10b981;
            color: #10b981;
        }

        .preset-btn.safe:hover {
            background: rgba(16, 185, 129, 0.15);
        }

        .preset-btn.risky {
            border-color: #f43f5e;
            color: #f43f5e;
        }

        .preset-btn.risky:hover {
            background: rgba(244, 63, 94, 0.15);
        }

        .start-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            background: #10b981;
            color: #0f172a;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.15);
            background: transparent;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: rgba(255,255,255,0.08);
            color: #f1f5f9;
        }

        /* Flow Visualization */
        .flow-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .flow-panel h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #8b5cf6;
        }

        .architecture {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 30px;
            position: relative;
        }

        .component {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
            position: relative;
        }

        .component.active {
            border-color: #10b981;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }

        .component.success {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        .component.error {
            border-color: #f43f5e;
            background: rgba(244, 63, 94, 0.15);
        }

        /* Translucent glass icons */
        .component-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 10px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .component-icon svg {
            width: 24px;
            height: 24px;
        }

        .component-icon.client-icon {
            background: rgba(99, 102, 241, 0.25);
        }

        .component-icon.client-icon svg {
            stroke: #a5b4fc;
            fill: none;
            stroke-width: 2;
        }

        .component-icon.prover-icon {
            background: rgba(168, 85, 247, 0.25);
        }

        .component-icon.prover-icon svg {
            stroke: #c4b5fd;
            fill: none;
            stroke-width: 2;
        }

        .component-icon.cosigner-icon {
            background: rgba(14, 165, 233, 0.25);
        }

        .component-icon.cosigner-icon svg {
            stroke: #7dd3fc;
            fill: none;
            stroke-width: 2;
        }

        .component-icon.wdk-icon {
            background: rgba(16, 185, 129, 0.25);
        }

        .component-icon.wdk-icon svg {
            stroke: #6ee7b7;
            fill: none;
            stroke-width: 2;
        }

        .component h3 {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .component p {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.3);
            font-size: 1.5rem;
            transition: color 0.3s;
        }

        .arrow.active {
            color: #10b981;
            animation: pulse 1s infinite;
        }

        .arrow-1 { left: calc(25% - 10px); }
        .arrow-2 { left: calc(50% - 10px); }
        .arrow-3 { left: calc(75% - 10px); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Steps Log */
        .steps-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            min-height: 480px;
            max-height: 520px;
            overflow-y: auto;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.05);
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s;
        }

        .step.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .step-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .step-icon.pending {
            background: rgba(148, 163, 184, 0.15);
            color: #94a3b8;
        }

        .step-icon.running {
            background: rgba(139, 92, 246, 0.3);
            color: #a78bfa;
            animation: spin 1s linear infinite;
        }

        .step-icon.success {
            background: rgba(16, 185, 129, 0.3);
            color: #34d399;
        }

        .step-icon.error {
            background: rgba(244, 63, 94, 0.3);
            color: #fb7185;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .step-detail {
            font-size: 0.8rem;
            color: #94a3b8;
            font-family: 'Monaco', 'Consolas', monospace;
            word-break: break-all;
        }

        .step-detail a {
            color: #34d399;
            text-decoration: none;
        }

        .step-detail a:hover {
            text-decoration: underline;
        }

        /* Result Banner */
        .result-banner {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            display: none;
        }

        .result-banner.success {
            display: block;
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .result-banner.error {
            display: block;
            background: rgba(244, 63, 94, 0.15);
            border: 1px solid rgba(244, 63, 94, 0.5);
        }

        .result-banner h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .result-banner p {
            color: #94a3b8;
        }

        .proof-explanation {
            margin-top: 16px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            text-align: left;
        }

        .proof-explanation-title {
            font-weight: 600;
            color: #10b981;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .proof-explanation ul {
            margin: 0;
            padding-left: 20px;
        }

        .proof-explanation li {
            color: #cbd5e1;
            font-size: 0.85rem;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .result-banner a {
            color: #34d399;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background: rgba(0, 212, 170, 0.2);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .result-banner a:hover {
            background: rgba(16, 185, 129, 0.25);
        }

        /* Explanation Section */
        .explanation {
            margin-top: 30px;
            padding: 24px;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .explanation h3 {
            color: #10b981;
            margin-bottom: 16px;
        }

        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .explanation-item {
            padding: 16px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .explanation-item h4 {
            font-size: 0.95rem;
            margin-bottom: 8px;
            color: #8b5cf6;
        }

        .explanation-item p {
            font-size: 0.85rem;
            color: #94a3b8;
            line-height: 1.5;
        }

        /* Technology Section */
        .tech-section {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .tech-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            padding: 24px;
        }

        .tech-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .tech-icon-box {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
        }

        .tech-icon-box svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
            fill: none;
        }

        .tech-card.tether .tech-icon-box {
            background: rgba(16, 185, 129, 0.25);
        }

        .tech-card.tether .tech-icon-box svg {
            stroke: #6ee7b7;
        }

        .tech-card.jolt .tech-icon-box {
            background: rgba(139, 92, 246, 0.25);
        }

        .tech-card.jolt .tech-icon-box svg {
            stroke: #c4b5fd;
        }

        .tech-card.tether h3 {
            color: #10b981;
        }

        .tech-card.jolt h3 {
            color: #8b5cf6;
        }

        .tech-card p {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .tech-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tech-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.06);
            border-radius: 6px;
            color: #34d399;
            text-decoration: none;
            font-size: 0.8rem;
            transition: background 0.2s;
        }

        .tech-link:hover {
            background: rgba(255,255,255,0.12);
        }

        .tech-link.tether {
            color: #34d399;
        }

        .tech-link.jolt {
            color: #a78bfa;
        }

        /* Real Implementation Section */
        .reality-section {
            margin-top: 30px;
            background: rgba(16, 185, 129, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.25);
            padding: 24px;
        }

        .reality-section h3 {
            color: #10b981;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reality-section h3 .badge {
            background: #10b981;
            color: #0f172a;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .reality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .reality-col h4 {
            font-size: 1rem;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #10b981;
        }

        .reality-list {
            list-style: none;
        }

        .reality-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.85rem;
            color: #cbd5e1;
        }

        .reality-list .icon {
            flex-shrink: 0;
            width: 20px;
            text-align: center;
            color: #34d399;
        }

        .verified-tx {
            margin-top: 20px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
        }

        .verified-tx h4 {
            color: #10b981;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .verified-tx .tx-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.8rem;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .verified-tx .tx-item a {
            color: #34d399;
            text-decoration: none;
        }

        .verified-tx .tx-item a:hover {
            text-decoration: underline;
        }

        .integration-note {
            margin-top: 20px;
            padding: 16px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 8px;
            border-left: 3px solid #8b5cf6;
        }

        .integration-note h4 {
            color: #a78bfa;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .integration-note p {
            color: #94a3b8;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .integration-note code {
            background: rgba(15, 23, 42, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            color: #c4b5fd;
        }

        /* UI Simulation Note */
        .ui-note {
            margin-top: 20px;
            padding: 12px 16px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 8px;
            border-left: 3px solid #fbbf24;
            font-size: 0.8rem;
            color: #fcd34d;
        }

        .ui-note code {
            background: rgba(15, 23, 42, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            color: #fcd34d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="integration-badges">
                <span class="integration-badge"><span class="dot wdk"></span> Built on WDK</span>
                <span class="integration-badge"><span class="dot jolt"></span> Powered by Jolt</span>
                <span class="integration-badge"><span class="dot live"></span> Sepolia Testnet</span>
            </div>
            <h1>Trustless Risk Gating for Tether WDK</h1>
            <p class="subtitle">ML-based authorization with cryptographic proof - no trust required</p>
            <div class="value-props">
                <div class="value-prop"><span class="check">[+]</span> Trustless verification - anyone can verify the proof</div>
                <div class="value-prop"><span class="check">[+]</span> Drop-in module for existing WDK transfer flows</div>
                <div class="value-prop"><span class="check">[+]</span> Model weights stay private, only decisions are proven</div>
            </div>
        </header>

        <div class="main-content">
            <div class="control-panel">
                <h2>Transaction Features</h2>

                <div class="preset-buttons">
                    <button class="preset-btn safe" onclick="loadPreset('safe')">Low Risk</button>
                    <button class="preset-btn risky" onclick="loadPreset('risky')">High Risk</button>
                </div>

                <div class="form-group">
                    <label>Recipient Address</label>
                    <input type="text" id="recipient" value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">
                </div>

                <div class="form-group">
                    <label>Amount (tUSDT)</label>
                    <input type="number" id="amount" value="100" min="1">
                </div>

                <div class="form-group">
                    <label>Budget Level (0-20)</label>
                    <input type="range" id="budget" min="0" max="20" value="15" oninput="updateSliderValue(this)">
                    <span class="slider-value">15</span>
                </div>

                <div class="form-group">
                    <label>Trust Score (0-10)</label>
                    <input type="range" id="trust" min="0" max="10" value="7" oninput="updateSliderValue(this)">
                    <span class="slider-value">7</span>
                </div>

                <div class="form-group">
                    <label>Amount Category (0-10)</label>
                    <input type="range" id="amountCat" min="0" max="10" value="3" oninput="updateSliderValue(this)">
                    <span class="slider-value">3</span>
                </div>

                <div class="form-group">
                    <label>Transaction Velocity (0-5)</label>
                    <input type="range" id="velocity" min="0" max="5" value="2" oninput="updateSliderValue(this)">
                    <span class="slider-value">2</span>
                </div>

                <button class="start-btn" id="startBtn" onclick="startDemo()">
                    Start Demo
                </button>
                <button class="reset-btn" onclick="resetDemo()">Reset</button>
            </div>

            <div class="flow-panel">
                <h2>End-to-End Flow</h2>

                <div class="architecture">
                    <div class="component" id="comp-client">
                        <div class="component-icon client-icon">
                            <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 9h6v6H9z"/><path d="M9 3v6M15 3v6M9 15v6M15 15v6M3 9h6M15 9h6M3 15h6M15 15h6"/></svg>
                        </div>
                        <h3>Client</h3>
                        <p>TypeScript SDK</p>
                    </div>
                    <span class="arrow arrow-1" id="arrow-1">-></span>
                    <div class="component" id="comp-prover">
                        <div class="component-icon prover-icon">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 3v4M12 17v4M3 12h4M17 12h4"/><circle cx="12" cy="12" r="3"/></svg>
                        </div>
                        <h3>Prover</h3>
                        <p>Rust zkML Engine</p>
                    </div>
                    <span class="arrow arrow-2" id="arrow-2">-></span>
                    <div class="component" id="comp-cosigner">
                        <div class="component-icon cosigner-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 2L3 7v6c0 5.5 3.8 10.3 9 11.5 5.2-1.2 9-6 9-11.5V7l-9-5z"/><path d="M9 12l2 2 4-4"/></svg>
                        </div>
                        <h3>Co-signer</h3>
                        <p>Proof Verifier</p>
                    </div>
                    <span class="arrow arrow-3" id="arrow-3">-></span>
                    <div class="component" id="comp-wdk">
                        <div class="component-icon wdk-icon">
                            <svg viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/><circle cx="7" cy="15" r="2"/></svg>
                        </div>
                        <h3>WDK</h3>
                        <p>Tether Transfer</p>
                    </div>
                </div>

                <div class="steps-container" id="stepsContainer">
                    <div class="step" id="step-0">
                        <div class="step-icon pending">1</div>
                        <div class="step-content">
                            <div class="step-title">Initialize Transfer Request</div>
                            <div class="step-detail">Preparing transaction features...</div>
                        </div>
                    </div>
                    <div class="step" id="step-1">
                        <div class="step-icon pending">2</div>
                        <div class="step-content">
                            <div class="step-title">Run ML Inference</div>
                            <div class="step-detail">ONNX model evaluates transaction risk...</div>
                        </div>
                    </div>
                    <div class="step" id="step-2">
                        <div class="step-icon pending">3</div>
                        <div class="step-content">
                            <div class="step-title">Generate SNARK Proof</div>
                            <div class="step-detail">Jolt creates zero-knowledge proof of inference...</div>
                        </div>
                    </div>
                    <div class="step" id="step-3">
                        <div class="step-icon pending">4</div>
                        <div class="step-content">
                            <div class="step-title">Submit to Co-signer</div>
                            <div class="step-detail">Sending proof + program I/O for verification...</div>
                        </div>
                    </div>
                    <div class="step" id="step-4">
                        <div class="step-icon pending">5</div>
                        <div class="step-content">
                            <div class="step-title">Verify SNARK Proof</div>
                            <div class="step-detail">Co-signer verifies proof against model...</div>
                        </div>
                    </div>
                    <div class="step" id="step-5">
                        <div class="step-icon pending">6</div>
                        <div class="step-content">
                            <div class="step-title">Sign Approval</div>
                            <div class="step-detail">Generate signature with nonce + timestamp...</div>
                        </div>
                    </div>
                    <div class="step" id="step-6">
                        <div class="step-icon pending">7</div>
                        <div class="step-content">
                            <div class="step-title">Execute Transfer</div>
                            <div class="step-detail">WDK submits transaction to blockchain...</div>
                        </div>
                    </div>
                </div>

                <div class="result-banner" id="resultBanner">
                    <h3 id="resultTitle"></h3>
                    <p id="resultMessage"></p>
                    <div id="proofExplanation" class="proof-explanation" style="display: none;">
                        <div class="proof-explanation-title">What the proof guarantees:</div>
                        <ul>
                            <li>The ML risk model evaluated this exact transaction</li>
                            <li>The model output was AUTHORIZED (not tampered with)</li>
                            <li>The same model was used by both prover and verifier</li>
                            <li>No one - not even the sender - could bypass or forge this approval</li>
                        </ul>
                    </div>
                    <a id="resultTxLink" href="#" target="_blank" style="display: none;">View on Etherscan</a>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h3>How It Works</h3>
            <div class="explanation-grid">
                <div class="explanation-item">
                    <h4>1. ML-Based Risk Assessment</h4>
                    <p>An ONNX neural network evaluates transaction features (budget, trust, velocity, etc.) to classify as AUTHORIZED or DENIED.</p>
                </div>
                <div class="explanation-item">
                    <h4>2. Zero-Knowledge Proof</h4>
                    <p>Jolt-Atlas generates a SNARK proof that the ML model was executed correctly, without revealing the model weights.</p>
                </div>
                <div class="explanation-item">
                    <h4>3. Independent Verification</h4>
                    <p>The co-signer independently verifies the proof, ensuring the same model produced the AUTHORIZED decision.</p>
                </div>
                <div class="explanation-item">
                    <h4>4. Cryptographic Approval</h4>
                    <p>Upon successful verification, the co-signer signs the transaction with a unique nonce to prevent replay attacks.</p>
                </div>
            </div>
        </div>

        <!-- Technology Section -->
        <div class="tech-section">
            <div class="tech-card tether">
                <h3><span class="tech-icon-box"><svg viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/><circle cx="7" cy="15" r="2"/></svg></span> Tether WDK</h3>
                <p>
                    The <strong>Wallet Development Kit (WDK)</strong> by Tether is an open-source, modular SDK for building
                    self-custodial wallets. It provides a unified interface across multiple blockchains including Ethereum,
                    Bitcoin, TON, TRON, and Solana. WDK enables gasless transactions via Account Abstraction (ERC-4337)
                    and is designed to work from embedded devices to server environments.
                </p>
                <p>
                    In this demo, WDK executes the final tUSDT transfer after the zkML proof is verified and
                    the co-signer approves the transaction.
                </p>
                <div class="tech-links">
                    <a href="https://docs.wallet.tether.io" target="_blank" class="tech-link tether">[docs] Documentation</a>
                    <a href="https://docs.wallet.tether.io/sdk/get-started" target="_blank" class="tech-link tether">[start] Get Started</a>
                    <a href="https://docs.wallet.tether.io/overview/about" target="_blank" class="tech-link tether">[info] About WDK</a>
                    <a href="https://wallet.tether.io" target="_blank" class="tech-link tether">[web] Official Site</a>
                </div>
            </div>

            <div class="tech-card jolt">
                <h3><span class="tech-icon-box"><svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></span> Jolt zkVM (a16z)</h3>
                <p>
                    <strong>Jolt</strong> is a high-performance zkVM (zero-knowledge virtual machine) for RISC-V from a16z crypto.
                    It generates SNARK proofs up to 2x faster than alternatives using a novel lookup-based design built on
                    Lasso. Jolt avoids recursion, quotient polynomials, and complex circuits in favor of sparse polynomials
                    and sum-check protocols.
                </p>
                <p>
                    In this project, we use <strong>jolt-atlas</strong> (zkML extension) to prove that an ONNX neural network
                    inference was computed correctly, enabling verifiable ML decisions.
                </p>
                <div class="tech-links">
                    <a href="https://github.com/a16z/jolt" target="_blank" class="tech-link jolt">[code] GitHub Repo</a>
                    <a href="https://a16zcrypto.com/posts/article/building-jolt/" target="_blank" class="tech-link jolt">[blog] Building Jolt</a>
                    <a href="https://a16zcrypto.com/posts/article/a-new-era-in-snark-design-releasing-jolt/" target="_blank" class="tech-link jolt">[news] Release Article</a>
                    <a href="https://eprint.iacr.org/2023/1217" target="_blank" class="tech-link jolt">[paper] Research Paper</a>
                </div>
            </div>
        </div>

        <!-- Real Implementation Section -->
        <div class="reality-section">
            <h3>Full Stack Implementation <span class="badge">ALL COMPONENTS REAL</span></h3>

            <div class="reality-grid">
                <div class="reality-col">
                    <h4>Backend (Rust)</h4>
                    <ul class="reality-list">
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>zkml-prover</strong> - Runs ONNX model via jolt-atlas, generates ~110KB SNARK proofs</span>
                        </li>
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>zkml-cosigner</strong> - Actix-Web server verifies Jolt proofs, signs with secp256k1</span>
                        </li>
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>authorization.onnx</strong> - Trained neural network for transaction classification</span>
                        </li>
                    </ul>
                </div>

                <div class="reality-col">
                    <h4>Frontend (TypeScript)</h4>
                    <ul class="reality-list">
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>@tetherto/wdk-wallet-evm</strong> - Real ERC-20 transfers via Tether WDK</span>
                        </li>
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>TestUSDT Contract</strong> - Deployed on Sepolia: 0x959413cfD31eBe4Bc81A57b284cD638b4Be88500</span>
                        </li>
                        <li>
                            <span class="icon">[+]</span>
                            <span><strong>Nonce Protection</strong> - Persistent counter prevents replay attacks</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="verified-tx">
                <h4>Verified Transactions on Sepolia</h4>
                <div class="tx-item">
                    <span>[TX]</span>
                    <a href="https://sepolia.etherscan.io/tx/0x39f5669338276e54f2491ec521409d11b15cf56a25589d747e518cd5be18b913" target="_blank">
                        0x39f5669338276e54f2491ec521409d11b15cf56a25589d747e518cd5be18b913
                    </a>
                    <span style="color: #34d399;">(100 tUSDT - AUTHORIZED)</span>
                </div>
                <div class="tx-item">
                    <span>[CONTRACT]</span>
                    <a href="https://sepolia.etherscan.io/address/0x959413cfD31eBe4Bc81A57b284cD638b4Be88500" target="_blank">
                        0x959413cfD31eBe4Bc81A57b284cD638b4Be88500
                    </a>
                    <span style="color: #94a3b8;">(TestUSDT Token)</span>
                </div>
            </div>

            <div class="integration-note">
                <h4>Run the Real System</h4>
                <p>
                    <code>cd cosigner && COSIGNER_PRIVATE_KEY=0x... cargo run --release</code><br>
                    <code>cd client && SEED_PHRASE="..." SEPOLIA_RPC_URL="..." npm run demo</code>
                </p>
                <p style="margin-top: 10px;">
                    The CLI demo executes real proofs (~3 sec), real verification, and real Sepolia transfers via Tether WDK.
                </p>
            </div>

            <div class="ui-note">
                <strong>About this visualization:</strong> This browser UI demonstrates the flow conceptually.
                The real system (prover, cosigner, WDK) runs via CLI and executes actual SNARK proofs on Sepolia.
                Run <code>npm run demo</code> in the client folder to execute real end-to-end transactions with cryptographic proofs.
            </div>
        </div>
    </div>

    <script>
        const presets = {
            safe: {
                budget: 15,
                trust: 7,
                amountCat: 3,
                velocity: 2,
                amount: 100
            },
            risky: {
                budget: 2,
                trust: 1,
                amountCat: 9,
                velocity: 5,
                amount: 50000
            }
        };

        const steps = [
            {
                component: 'client',
                title: 'Initialize Transfer Request',
                detail: (features) => `Features: budget=${features.budget}, trust=${features.trust}, amount_cat=${features.amountCat}, velocity=${features.velocity}`,
                duration: 800
            },
            {
                component: 'prover',
                arrow: 1,
                title: 'Run ML Inference',
                detail: () => 'Executing authorization.onnx model...',
                duration: 1500
            },
            {
                component: 'prover',
                title: 'Generate SNARK Proof',
                detail: () => 'Creating Jolt SNARK proof (~110KB)...',
                duration: 2000
            },
            {
                component: 'cosigner',
                arrow: 2,
                title: 'Submit to Co-signer',
                detail: () => 'POST /verify with proof + program_io + tx_details',
                duration: 500
            },
            {
                component: 'cosigner',
                title: 'Verify SNARK Proof',
                detail: () => 'Deserializing and verifying proof against verifier preprocessing...',
                duration: 1800
            },
            {
                component: 'cosigner',
                title: 'Sign Approval',
                detail: (_, nonce) => `Signature: keccak256(to || amount || token || nonce=${nonce} || timestamp)`,
                duration: 300
            },
            {
                component: 'wdk',
                arrow: 3,
                title: 'Execute Transfer',
                detail: (features) => `Transferring ${features.amount} tUSDT via Tether WDK...`,
                duration: 1200
            }
        ];

        let isRunning = false;
        let lastTxHash = null;

        function updateSliderValue(input) {
            input.nextElementSibling.textContent = input.value;
        }

        function loadPreset(type) {
            const preset = presets[type];
            document.getElementById('budget').value = preset.budget;
            document.getElementById('trust').value = preset.trust;
            document.getElementById('amountCat').value = preset.amountCat;
            document.getElementById('velocity').value = preset.velocity;
            document.getElementById('amount').value = preset.amount;

            document.querySelectorAll('input[type="range"]').forEach(input => {
                input.nextElementSibling.textContent = input.value;
            });
        }

        function getFeatures() {
            return {
                budget: parseInt(document.getElementById('budget').value),
                trust: parseInt(document.getElementById('trust').value),
                amountCat: parseInt(document.getElementById('amountCat').value),
                velocity: parseInt(document.getElementById('velocity').value),
                amount: parseInt(document.getElementById('amount').value),
                recipient: document.getElementById('recipient').value
            };
        }

        function isLikelyAuthorized(features) {
            const riskScore = (20 - features.budget) + (10 - features.trust) + features.amountCat + features.velocity * 2;
            return riskScore < 25;
        }

        function resetDemo() {
            isRunning = false;
            document.getElementById('startBtn').disabled = false;

            document.querySelectorAll('.component').forEach(c => {
                c.classList.remove('active', 'success', 'error');
            });

            document.querySelectorAll('.arrow').forEach(a => {
                a.classList.remove('active');
            });

            document.querySelectorAll('.step').forEach((step, i) => {
                step.classList.remove('visible');
                const icon = step.querySelector('.step-icon');
                icon.className = 'step-icon pending';
                icon.textContent = i + 1;
            });

            document.getElementById('resultBanner').className = 'result-banner';
            document.getElementById('resultTxLink').style.display = 'none';
            document.getElementById('proofExplanation').style.display = 'none';
        }

        async function startDemo() {
            if (isRunning) return;
            isRunning = true;

            resetDemo();
            document.getElementById('startBtn').disabled = true;

            const features = getFeatures();
            const authorized = isLikelyAuthorized(features);
            const nonce = Math.floor(Math.random() * 10000) + 1;

            lastTxHash = null;

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepEl = document.getElementById(`step-${i}`);
                const icon = stepEl.querySelector('.step-icon');
                const detail = stepEl.querySelector('.step-detail');

                stepEl.classList.add('visible');

                if (step.component) {
                    document.querySelectorAll('.component').forEach(c => c.classList.remove('active'));
                    document.getElementById(`comp-${step.component}`).classList.add('active');
                }

                if (step.arrow) {
                    document.getElementById(`arrow-${step.arrow}`).classList.add('active');
                }

                icon.className = 'step-icon running';
                icon.textContent = '*';
                detail.textContent = step.detail(features, nonce);

                await sleep(step.duration);

                if (i === 1 && !authorized) {
                    icon.className = 'step-icon error';
                    icon.textContent = 'X';
                    detail.textContent = 'Model output: DENIED (high risk transaction)';

                    document.getElementById(`comp-${step.component}`).classList.add('error');

                    showResult(false, 'Transaction Denied', 'The ML model classified this transaction as high-risk. No proof was generated.', null);
                    document.getElementById('startBtn').disabled = false;
                    isRunning = false;
                    return;
                }

                icon.className = 'step-icon success';
                icon.textContent = '+';
                document.getElementById(`comp-${step.component}`).classList.remove('active');
                document.getElementById(`comp-${step.component}`).classList.add('success');

                if (i === 1) {
                    detail.textContent = 'Model output: AUTHORIZED (class 0)';
                } else if (i === 2) {
                    detail.textContent = 'Proof generated: 0x7a4b3c... (110,432 bytes)';
                } else if (i === 4) {
                    detail.textContent = 'Proof verification: PASSED';
                } else if (i === 6) {
                    lastTxHash = generateTxHash();
                    detail.innerHTML = `TX: <a href="https://sepolia.etherscan.io/tx/0x${lastTxHash}" target="_blank">0x${lastTxHash.slice(0, 16)}...</a> (confirmed)`;
                }
            }

            showResult(true, 'Transfer Complete!', `Successfully transferred ${features.amount} tUSDT to ${features.recipient.slice(0, 10)}...`, lastTxHash);
            document.getElementById('startBtn').disabled = false;
            isRunning = false;
        }

        function showResult(success, title, message, txHash) {
            const banner = document.getElementById('resultBanner');
            banner.className = `result-banner ${success ? 'success' : 'error'}`;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;

            const proofExplanation = document.getElementById('proofExplanation');
            proofExplanation.style.display = success ? 'block' : 'none';

            const txLink = document.getElementById('resultTxLink');
            if (success && txHash) {
                txLink.href = `https://sepolia.etherscan.io/tx/0x${txHash}`;
                txLink.style.display = 'inline-block';
            } else {
                txLink.style.display = 'none';
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function generateTxHash() {
            return Array.from({length: 64}, () => Math.floor(Math.random() * 16).toString(16)).join('');
        }

        document.querySelectorAll('input[type="range"]').forEach(input => {
            updateSliderValue(input);
        });
    </script>
</body>
</html>
